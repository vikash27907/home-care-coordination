<%- include("../partials/head", { title }) %>

<!-- Include Sidebar -->
<%- include("sidebar") %>

<div class="admin-main">
  <!-- Page Header -->
  <div class="page-header">
    <h1><span class="page-icon">üë©‚Äç‚öïÔ∏è</span> Nurse Management</h1>
    <p>View and manage all registered nurses. Click on any card to view full profile.</p>
  </div>

  <div style="margin-bottom:20px;">
    <a href="/admin/nurses">Active Users</a> |
    <a href="/admin/nurses?deleted=true">Deleted Users</a>
  </div>

  <!-- Search & Filter -->
  <div class="filter-bar">
    <div class="search-box">
      <span class="search-icon">üîç</span>
      <input type="text" id="searchInput" placeholder="Search by name, email, phone..." onkeyup="filterCards()">
    </div>
    <div class="filter-dropdown">
      <select id="statusFilter" onchange="filterCards()">
        <option value="All">All Status</option>
        <option value="Pending" <%= statusFilter === 'Pending' ? 'selected' : '' %>>Pending</option>
        <option value="Approved" <%= statusFilter === 'Approved' ? 'selected' : '' %>>Approved</option>
        <option value="Rejected" <%= statusFilter === 'Rejected' ? 'selected' : '' %>>Rejected</option>
        <option value="Deleted" <%= statusFilter === 'Deleted' ? 'selected' : '' %>>Deleted Users</option>
      </select>
    </div>
  </div>

  <!-- Status Tabs -->
  <nav class="filter-tabs">
    <a href="/admin/nurses?status=All" class="tab <%= statusFilter === 'All' ? 'active' : '' %>">All</a>
    <a href="/admin/nurses?status=Pending" class="tab <%= statusFilter === 'Pending' ? 'active' : '' %>">
      Pending <% if (nurseCounts.pending > 0) { %><span class="badge"><%= nurseCounts.pending %></span><% } %>
    </a>
    <a href="/admin/nurses?status=Approved" class="tab <%= statusFilter === 'Approved' ? 'active' : '' %>">Approved</a>
    <a href="/admin/nurses?status=Rejected" class="tab <%= statusFilter === 'Rejected' ? 'active' : '' %>">Rejected</a>
    <a href="/admin/nurses?status=Deleted" class="tab <%= statusFilter === 'Deleted' ? 'active' : '' %>">
      Deleted Users <% if (nurseCounts.deleted > 0) { %><span class="badge"><%= nurseCounts.deleted %></span><% } %>
    </a>
  </nav>

  <!-- Quick Stats -->
  <div class="quick-stats">
    <div class="stat-item">
      <span class="stat-label">Total Active:</span>
      <span class="stat-value"><%= nurseCounts.totalActive %></span>
    </div>
    <div class="stat-item">
      <span class="stat-label">Pending:</span>
      <span class="stat-value"><%= nurseCounts.pending %></span>
    </div>
    <div class="stat-item">
      <span class="stat-label">Approved:</span>
      <span class="stat-value"><%= nurseCounts.approved %></span>
    </div>
    <div class="stat-item">
      <span class="stat-label">Deleted:</span>
      <span class="stat-value"><%= nurseCounts.deleted %></span>
    </div>
  </div>

  <% if (!nurses.length) { %>
    <div class="empty-state">
      <p>No nurses found for this filter.</p>
      <a href="/admin/nurses" class="btn btn-primary">View All Nurses</a>
    </div>
  <% } else { %>
    <!-- Cards Grid -->
    <div class="cards-grid" id="nursesGrid">
      <% nurses.forEach((nurse) => { %>
        <%- include("card-nurse", { nurse: nurse, statusFilter: statusFilter, updatedNurseId: updatedNurseId, visibilityUpdate: visibilityUpdate }) %>
      <% }); %>
    </div>
  <% } %>
</div>

<script>
function filterCards() {
  const searchTerm = document.getElementById('searchInput').value.toLowerCase();
  const statusFilter = document.getElementById('statusFilter').value;
  const cards = document.querySelectorAll('.profile-card');
  
  cards.forEach(card => {
    const name = card.querySelector('.profile-name')?.textContent.toLowerCase() || '';
    const email = card.querySelector('.detail-value')?.textContent.toLowerCase() || '';
    const status = card.querySelector('.status-badge')?.textContent.trim() || '';
    const isDeleted = card.dataset.userDeleted === 'true';
    
    const matchesSearch = name.includes(searchTerm) || email.includes(searchTerm);
    const matchesStatus = statusFilter === 'Deleted'
      ? isDeleted
      : (!isDeleted && (statusFilter === 'All' || status === statusFilter));
    
    card.style.display = (matchesSearch && matchesStatus) ? 'block' : 'none';
  });
}
</script>

<%- include("../partials/footer") %>
