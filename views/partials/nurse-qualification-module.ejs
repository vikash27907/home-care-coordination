<%!
const masterQualifications = [
  "10th (SSC)",
  "12th (HSC)",
  "ANM",
  "GNM",
  "BSc Nursing",
  "MSc Nursing"
];

const currentQualifications = Array.isArray(nurse.qualifications)
  ? nurse.qualifications
  : [];
%>

<form 
  action="/nurse/profile/qualifications" 
  method="POST" 
  enctype="multipart/form-data"
  class="qualification-module"
>
  <div class="qualifications-grid">
    <% masterQualifications.forEach(function(qual) {
       const existingQual = currentQualifications.find(q => q.name === qual);
       const isSelected = !!existingQual;
       const safeName = qual.replace(/[^a-zA-Z0-9]/g, "_");
    %>
    <div class="qualification-item">
      <label class="qual-checkbox">
        <input
          type="checkbox"
          name="qualifications"
          value="<%= qual %>"
          <%= isSelected ? "checked" : "" %>
        />
        <span class="qual-name"><%= qual %></span>
      </label>

      <div class="cert-upload-section" style="display: <%= isSelected ? 'block' : 'none' %>;">
        <input
          type="file"
          name="cert_<%= safeName %>"
          accept=".pdf,.jpg,.jpeg,.png"
          class="cert-file-input"
          data-qual="<%= qual %>"
        />

        <% if (existingQual && existingQual.certificate_url) { %>
          <div class="cert-status">
            <a href="<%= existingQual.certificate_url %>" target="_blank" class="cert-link">
              View Certificate
            </a>
            <% if (existingQual.verified) { %>
              <span class="badge verified">Verified</span>
            <% } else { %>
              <span class="badge pending">Pending Verification</span>
            <% } %>
          </div>
        <% } else { %>
          <span class="no-cert">No certificate uploaded</span>
        <% } %>
      </div>
    </div>
    <% }) %>
  </div>

  <button type="submit" class="btn primary">Save Qualifications</button>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Toggle certificate upload section based on checkbox
  const checkboxes = document.querySelectorAll('input[name="qualifications"]');
  
  checkboxes.forEach(function(checkbox) {
    checkbox.addEventListener('change', function() {
      const item = this.closest('.qualification-item');
      const certSection = item.querySelector('.cert-upload-section');
      if (certSection) {
        certSection.style.display = this.checked ? 'block' : 'none';
      }
    });
  });

  // File size validation
  const fileInputs = document.querySelectorAll('.cert-file-input');
  const maxSize = 2 * 1024 * 1024; // 2MB

  fileInputs.forEach(function(input) {
    input.addEventListener('change', function() {
      if (this.files && this.files[0]) {
        if (this.files[0].size > maxSize) {
          alert('File size must be less than 2MB');
          this.value = '';
        }
      }
    });
  });
});
</script>

<style>
.qualification-module {
  margin-top: 10px;
}

.qualifications-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 15px;
  margin-bottom: 20px;
}

.qualification-item {
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  padding: 15px;
  background: #f8fafc;
}

.qual-checkbox {
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  margin-bottom: 10px;
}

.qual-checkbox input[type="checkbox"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
}

.qual-name {
  font-weight: 600;
  color: #1e293b;
}

.cert-upload-section {
  margin-top: 10px;
}

.cert-file-input {
  width: 100%;
  padding: 8px;
  border: 1px solid #cbd5e1;
  border-radius: 6px;
  font-size: 14px;
}

.cert-status {
  margin-top: 8px;
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
}

.cert-link {
  color: #2563eb;
  font-weight: 500;
  text-decoration: none;
}

.cert-link:hover {
  text-decoration: underline;
}

.badge {
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 600;
}

.badge.verified {
  background: #dcfce7;
  color: #166534;
}

.badge.pending {
  background: #fef3c7;
  color: #92400e;
}

.no-cert {
  font-size: 12px;
  color: #94a3b8;
  font-style: italic;
}
</style>
