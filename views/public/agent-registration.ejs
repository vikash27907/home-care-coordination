<%- include("../partials/head", { title }) %>

<section class="form-section narrow">
  <h1>Agent Registration Application</h1>
  <p>Your account remains <strong>Pending</strong> until verification is complete.</p>
  <form method="POST" action="/agent-registration" class="form-grid" id="agentRegistrationForm" enctype="multipart/form-data">
    <label>
      Full Name <span class="required-indicator" title="Required"></span>
      <input name="fullName" type="text" required />
    </label>
    
    <label>
      Email <span class="required-indicator" title="Required"></span>
      <input name="email" type="email" required />
    </label>
    
    <label>
      Phone Number <span class="required-indicator" title="Required"></span>
      <input 
        name="phoneNumber" 
        type="tel" 
        maxlength="10" 
        pattern="[6-9][0-9]{9}"
        placeholder="10-digit mobile number"
        required 
        title="Enter 10-digit Indian mobile number starting with 6, 7, 8, or 9"
      />
    </label>
    
    <label>
      City / Region <span class="required-indicator" title="Required"></span>
      <input name="region" type="text" required />
    </label>
    
    <!-- Company Name (Optional) -->
    <label>
      Company Name (Optional)
      <input name="companyName" type="text" placeholder="Your company name" />
    </label>
    
    <!-- Profile Image Upload (Optional) -->
    <div class="full-width">
      <label>Profile Photo (Optional)</label>
      <div class="file-upload-container" id="profileImageUpload">
        <input 
          type="file" 
          name="profileImage" 
          id="profileImageInput"
          accept="image/*"
          data-max-size="2097152"
        />
        <label for="profileImageInput" class="file-upload-label">
          <span class="upload-icon">üì∑</span>
          <span>Click to upload profile photo</span>
          <small class="file-info">Max size: 2MB (JPG, PNG)</small>
        </label>
        <div class="file-upload-preview" id="profileImagePreview" style="display: none;">
          <img id="profileImageImg" src="" alt="Profile Preview" />
          <button type="button" class="file-remove" onclick="removeProfileImage()">‚úï</button>
        </div>
      </div>
    </div>
    
    <!-- Password Field with Show Toggle -->
    <label class="full-width">
      Password <span class="required-indicator" title="Required"></span>
      <div class="password-field-wrapper">
        <input 
          name="password" 
          type="password" 
          id="passwordInput"
          minlength="6" 
          required
          placeholder="Minimum 6 characters"
        />
        <button type="button" class="password-toggle" onclick="togglePassword()" aria-label="Show password">
          üëÅ
        </button>
      </div>
      <small class="helper-text">Minimum 6 characters required</small>
    </label>

    <button type="submit" class="btn primary full-width btn-submit" id="submitBtn">
      <span class="btn-text">Submit Registration</span>
      <span class="spinner" style="display: none;"></span>
    </button>
  </form>
</section>

<script>
  // Password toggle functionality
  function togglePassword() {
    const passwordInput = document.getElementById('passwordInput');
    const toggleBtn = document.querySelector('.password-toggle');
    if (passwordInput.type === 'password') {
      passwordInput.type = 'text';
      toggleBtn.textContent = 'üôà';
    } else {
      passwordInput.type = 'password';
      toggleBtn.textContent = 'üëÅ';
    }
  }
  
  // Profile image preview
  document.getElementById('profileImageInput').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const preview = document.getElementById('profileImagePreview');
    const previewImg = document.getElementById('profileImageImg');
    
    if (file) {
      // Check file size (max 2MB)
      if (file.size > 2 * 1024 * 1024) {
        alert('File size must be less than 2MB');
        this.value = '';
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function(e) {
        previewImg.src = e.target.result;
        preview.style.display = 'flex';
      };
      reader.readAsDataURL(file);
    }
  });
  
  function removeProfileImage() {
    document.getElementById('profileImageInput').value = '';
    document.getElementById('profileImagePreview').style.display = 'none';
    document.getElementById('profileImageImg').src = '';
  }
  
  // Form submission with loading state
  document.getElementById('agentRegistrationForm').addEventListener('submit', function(e) {
    const submitBtn = document.getElementById('submitBtn');
    const passwordInput = document.getElementById('passwordInput');
    
    // Validate password minimum length
    if (passwordInput.value.length < 6) {
      e.preventDefault();
      alert('Password must be at least 6 characters');
      return;
    }
    
    // Show loading state
    submitBtn.classList.add('loading');
    submitBtn.querySelector('.btn-text').textContent = 'Submitting...';
    submitBtn.querySelector('.spinner').style.display = 'inline-block';
    submitBtn.disabled = true;
  });
</script>

<%- include("../partials/footer") %>
