<%- include("../partials/head", { title }) %>

<section class="form-section">
  <div class="section-header">
    <div class="header-text">
      <h1>Patient Care Request</h1>
      <p>Share your care needs and our coordination team will contact you with the next steps.</p>
    </div>
    <a href="/track-request" class="btn btn-track">Already Registered? Track Your Request</a>
  </div>

  <% if (preferredNurse) { %>
  <div class="card selected-nurse">
    <h3>Preferred Nurse Selected</h3>
    <p><strong><%= preferredNurse.fullName %></strong> (<%= preferredNurse.isAvailable ? 'Available' : 'Not Available' %>)</p>
    <p>Skills: <%= preferredNurse.skills.join(', ') || '-' %></p>
  </div>
  <% } %>

  <form method="POST" action="/request-care" class="form-grid" id="requestCareForm">
    <input type="hidden" name="preferredNurseId" value="<%= preferredNurse ? preferredNurse.id : '' %>" />
    
    <label>
      Full Name <span class="required-indicator" title="Required"></span>
      <input name="fullName" type="text" required />
    </label>
    
    <label>
      Email <span class="required-indicator" title="Required"></span>
      <input name="email" type="email" required />
    </label>
    
    <label>
      Phone Number <span class="required-indicator" title="Required"></span>
      <input 
        name="phoneNumber" 
        type="tel" 
        maxlength="10" 
        pattern="[6-9][0-9]{9}"
        placeholder="10-digit mobile number"
        required 
        title="Enter 10-digit Indian mobile number starting with 6, 7, 8, or 9"
      />
    </label>
    
    <label>
      City <span class="required-indicator" title="Required"></span>
      <input name="city" type="text" required />
    </label>
    
    <!-- Service Schedule -->
    <label class="full-width">
      Service Schedule <span class="required-indicator" title="Required"></span>
      <select name="serviceSchedule" id="serviceSchedule" required>
        <option value="">Select service schedule...</option>
        <option value="8 Hour Shift">8 Hour Shift</option>
        <option value="12 Hour Shift (Day)">12 Hour Shift (Day)</option>
        <option value="12 Hour Shift (Night)">12 Hour Shift (Night)</option>
        <option value="24 Hour Live-In">24 Hour Live-In</option>
        <option value="One-Time / Few Visits">One-Time / Few Visits</option>
      </select>
      <small class="helper-text">Select the type of care service you need</small>
    </label>
    
    <!-- Duration -->
    <label class="full-width">
      Duration <span class="required-indicator" title="Required"></span>
      <div class="duration-inputs" style="display: flex; gap: 10px; align-items: center;">
        <input 
          type="number" 
          name="durationValue" 
          id="durationValue" 
          min="1" 
          required 
          placeholder="Enter number"
          style="width: 120px;"
        />
        <select name="durationUnit" id="durationUnit" required style="flex: 1;">
          <option value="">Select Unit</option>
          <option value="days">Days</option>
          <option value="months">Months</option>
        </select>
      </div>
    </label>
    
    <!-- Budget -->
    <div class="form-group">
      <label for="budget" id="budgetLabel">Budget (INR)</label>
      <input
        type="number"
        id="budget"
        name="budget"
        class="form-control"
        required
        placeholder="Enter your budget"
      />
    </div>
    
    <!-- Notes -->
    <label class="full-width">
      Additional Notes
      <textarea name="notes" rows="3" placeholder="Any specific requirements, medical conditions, or special instructions..."></textarea>
    </label>
    
    <button type="submit" class="btn primary full-width btn-submit" id="submitBtn">
      <span class="btn-text">Submit Request</span>
      <span class="spinner" style="display: none;"></span>
    </button>
  </form>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const durationUnitSelect = document.getElementById("durationUnit");
      const budgetLabel = document.getElementById("budgetLabel");

      function updateBudgetLabel() {
        const unit = durationUnitSelect.value;

        if (unit === "days") {
          budgetLabel.innerText = "Per Day Budget (INR)";
        } else if (unit === "months") {
          budgetLabel.innerText = "Monthly Budget (INR)";
        } else if (unit === "years") {
          budgetLabel.innerText = "Monthly Budget (INR)";
        } else {
          budgetLabel.innerText = "Budget (INR)";
        }
      }

      durationUnitSelect.addEventListener("change", updateBudgetLabel);

      // Run once on page load
      updateBudgetLabel();
    });
  </script>

  <aside class="urgent-support">
    <h2>Need Immediate Assistance?</h2>
    <p>
      For emergency or urgent care response, connect with our support team directly on WhatsApp.
    </p>
    <div class="support-row">
      <a
        class="btn whatsapp"
        href="https://wa.me/919138913355?text=Hello%20Prisha%20Home%20Care%2C%20I%20need%20immediate%20patient%20care%20support."
        target="_blank"
        rel="noopener"
        >Connect on WhatsApp</a
      >
      <span class="support-number">+91 9138913355</span>
    </div>
  </aside>
</section>

<style>
.section-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 20px;
  flex-wrap: wrap;
  gap: 15px;
}

.header-text {
  flex: 1;
  min-width: 250px;
}

.btn-track {
  background: #667eea;
  color: white;
  padding: 12px 20px;
  border-radius: 5px;
  text-decoration: none;
  font-weight: 600;
  white-space: nowrap;
  transition: background 0.3s;
}

.btn-track:hover {
  background: #5568d3;
  color: white;
}

.budget-inputs {
  display: flex;
  gap: 10px;
  margin-top: 8px;
  align-items: center;
}

.budget-inputs input {
  flex: 1;
}

.budget-separator {
  color: #666;
  font-weight: 500;
}

.helper-text {
  display: block;
  margin-top: 4px;
  color: #666;
  font-size: 0.875rem;
}
</style>

<%- include("../partials/footer") %>
