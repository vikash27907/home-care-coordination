<%- include("../partials/head", { title }) %>

<section class="form-section">
  <h1>Edit Request</h1>
  <p>Update your care request details below.</p>

  <% if (locals.flash && locals.flash.type === 'error') { %>
    <div class="alert error">
      <%= locals.flash.message %>
    </div>
  <% } %>

  <% if (locals.verified) { %>
    <div class="alert success">
      Identity verified! You can now edit your request.
    </div>
  <% } %>

  <form method="POST" action="/edit-request/<%= request.requestId %>/update" class="form-grid">
    <!-- Service Schedule -->
    <label class="full-width">
      Service Schedule <span class="required-indicator" title="Required"></span>
      <select name="serviceSchedule" id="serviceSchedule" required>
        <option value="">Select service schedule...</option>
        <% serviceScheduleOptions.forEach(function(option) { %>
          <option value="<%= option.value %>" <%= request.serviceSchedule === option.value ? 'selected' : '' %>>
            <%= option.label %>
          </option>
        <% }); %>
      </select>
    </label>
    
    <!-- Duration -->
    <label class="full-width">
      Service Duration
      <input 
        name="duration" 
        type="text" 
        value="<%= request.duration || '' %>"
        placeholder="e.g., 30 Days"
      />
    </label>
    
    <!-- Budget Range -->
    <div class="full-width">
      <label>
        Budget Range (â‚¹)
      </label>
      <div class="budget-inputs">
        <input 
          name="budgetMin" 
          type="number" 
          value="<%= request.budgetMin || '' %>"
          placeholder="Minimum"
          min="5000"
          max="200000"
        />
        <input 
          name="budgetMax" 
          type="number" 
          value="<%= request.budgetMax || '' %>"
          placeholder="Maximum"
          min="5000"
          max="200000"
        />
      </div>
    </div>
    
    <!-- Notes -->
    <label class="full-width">
      Additional Notes
      <textarea name="notes" rows="4" placeholder="Any specific requirements..."><%= request.notes || '' %></textarea>
    </label>
    
    <!-- Non-editable fields (display only) -->
    <div class="full-width readonly-fields">
      <h3>Request Information (Cannot be edited)</h3>
      <div class="field-row">
        <span class="label">Request ID:</span>
        <span class="value"><%= request.requestId %></span>
      </div>
      <div class="field-row">
        <span class="label">Email:</span>
        <span class="value"><%= request.email %></span>
      </div>
      <div class="field-row">
        <span class="label">Created:</span>
        <span class="value"><%= request.createdAt ? new Date(request.createdAt).toLocaleString() : 'N/A' %></span>
      </div>
    </div>
    
    <button type="submit" class="btn primary full-width">
      Update Request
    </button>
  </form>

  <div class="form-footer">
    <a href="/track-request?requestId=<%= request.requestId %>" class="btn">Cancel and Return</a>
  </div>
</section>

<style>
.alert {
  padding: 15px;
  border-radius: 5px;
  margin: 15px 0;
}

.alert.error {
  background: #fee;
  border: 1px solid #fcc;
  color: #c33;
}

.alert.success {
  background: #efe;
  border: 1px solid #cfc;
  color: #3c3;
}

.budget-inputs {
  display: flex;
  gap: 10px;
  margin-top: 8px;
}

.budget-inputs input {
  flex: 1;
}

.readonly-fields {
  background: #f5f5f5;
  padding: 20px;
  border-radius: 8px;
  margin: 20px 0;
}

.readonly-fields h3 {
  margin-top: 0;
  color: #666;
  font-size: 14px;
}

.field-row {
  display: flex;
  padding: 8px 0;
  border-bottom: 1px solid #eee;
}

.field-row:last-child {
  border-bottom: none;
}

.field-row .label {
  font-weight: bold;
  color: #666;
  width: 120px;
}

.field-row .value {
  color: #333;
}

.form-footer {
  margin-top: 20px;
  text-align: center;
}
</style>

<%- include("../partials/footer") %>
